<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äº”ç›®ä¸¦ã¹ï½œåä¹è·¯æ€è€ƒç›¤</title>

<link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho&family=Zen+Kurenaido&display=swap" rel="stylesheet">

<style>
:root{
  --paper:#f6f1e7;
  --ink:#111;
  --wood1:#7b4a21;
  --wood2:#3d220f;
}

body{
  margin:0;
  background:var(--paper);
  color:var(--ink);
  font-family:"Shippori Mincho",serif;
}

.app{
  max-width:560px;
  margin:auto;
  padding:10px;
}

.header{text-align:center;}
.header h1{margin:4px 0;letter-spacing:6px;font-weight:normal;}
.subtitle{font-size:12px;opacity:.6}

/* controls */
.controls{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:6px 0;
}
select,button{
  font-family:"Shippori Mincho",serif;
  padding:6px 14px;
  border-radius:999px;
  border:1px solid #333;
  background:#fff;
}

/* status */
#status{text-align:center;margin:6px 0;font-size:14px}

/* board */
.board-wrap{
  background:linear-gradient(145deg,var(--wood1),var(--wood2));
  padding:14px;
  border-radius:16px;
  box-shadow:inset 0 0 0 2px rgba(0,0,0,.4);
}

.board{
  position:relative;
  width:100%;
  aspect-ratio:1/1;
}

.grid{
  position:absolute;
  inset:0;
  background:
    repeating-linear-gradient(to right,
      transparent 0,
      transparent calc(100%/18 - 1px),
      rgba(0,0,0,.5) calc(100%/18 - 1px),
      rgba(0,0,0,.5) calc(100%/18)
    ),
    repeating-linear-gradient(to bottom,
      transparent 0,
      transparent calc(100%/18 - 1px),
      rgba(0,0,0,.5) calc(100%/18 - 1px),
      rgba(0,0,0,.5) calc(100%/18)
    );
}

.points{
  position:absolute;
  inset:0;
}

/* stones */
.stone{
  position:absolute;
  width:18px;
  height:18px;
  border-radius:50%;
  transform:translate(-50%,-50%) scale(0);
  animation:drop .2s ease forwards;
}
.black{background:radial-gradient(circle at 30% 30%,#555,#000);}
.white{background:radial-gradient(circle at 30% 30%,#fff,#ccc);}

.preview{
  opacity:.45;
  transform:translate(-50%,-50%) scale(.85);
  filter:blur(.3px);
  animation:none;
}

@keyframes drop{
  to{transform:translate(-50%,-50%) scale(1);}
}

/* ink */
.ink{
  position:absolute;
  width:50px;height:50px;
  border-radius:50%;
  background:radial-gradient(circle,rgba(0,0,0,.25),transparent 70%);
  transform:translate(-50%,-50%);
  animation:ink .6s ease;
}
@keyframes ink{
  from{opacity:.7;transform:translate(-50%,-50%) scale(.5);}
  to{opacity:0;transform:translate(-50%,-50%) scale(1.5);}
}

/* log */
.log{
  margin-top:8px;
  background:#fff;
  border:2px solid #111;
  border-radius:12px;
  padding:6px;
  max-height:200px;
  overflow-y:auto;
  font-family:"Zen Kurenaido",sans-serif;
  font-size:12px;
}
.player{color:#1e3a8a}
.cpu{color:#7f1d1d}
.result{font-weight:bold}

/* petals */
.petal{
  position:fixed;
  top:-20px;
  font-size:22px;
  animation:fall linear forwards;
}
@keyframes fall{
  to{transform:translateY(120vh) rotate(360deg);opacity:0;}
}
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <h1>äº”ç›®ä¸¦ã¹</h1>
    <div class="subtitle">åä¹è·¯ãƒ»æ€è€ƒè¦³æ¸¬ç›¤</div>
  </div>

  <div class="controls">
    <select id="level">
      <option>æ¾</option>
      <option>ç«¹</option>
      <option>æ¢…</option>
    </select>
    <button onclick="resetGame()">å†æˆ¦</button>
  </div>

  <div id="status">ã‚ãªãŸï¼ˆé»’ï¼‰ã®ç•ªï½œ2å›ã‚¿ãƒƒãƒ—ã§ç¢ºå®š</div>

  <div class="board-wrap">
    <div class="board" id="board">
      <div class="grid"></div>
      <div class="points" id="points"></div>
    </div>
  </div>

  <div class="log" id="log"></div>
</div>

<script>
const SIZE=19;
const points=document.getElementById("points");
const logEl=document.getElementById("log");
const statusEl=document.getElementById("status");

let board=[...Array(SIZE)].map(()=>Array(SIZE).fill(null));
let gameOver=false;
let pending=null;

const step=100/18;

/* init points */
for(let y=0;y<SIZE;y++){
  for(let x=0;x<SIZE;x++){
    const p=document.createElement("div");
    p.style.position="absolute";
    p.style.left=(x*step)+"%";
    p.style.top=(y*step)+"%";
    p.style.width="20px";
    p.style.height="20px";
    p.style.transform="translate(-50%,-50%)";
    p.onclick=()=>tap(x,y);
    points.appendChild(p);
  }
}

function log(t,c){
  const d=document.createElement("div");
  d.textContent=t;
  d.className=c;
  logEl.appendChild(d);
  logEl.scrollTop=logEl.scrollHeight;
}

function rank(s){
  if(s>=1000) return "æ¥µ";
  if(s>=300) return "è‰¯";
  if(s>=80) return "æ™®";
  return "å¾®";
}

function evalMove(x,y,c){
  let score=0;
  [[1,0],[0,1],[1,1],[1,-1]].forEach(([dx,dy])=>{
    let a=0,b=0,i=1;
    while(board[y+dy*i]?.[x+dx*i]===c){a++;i++;}
    i=1;
    while(board[y-dy*i]?.[x-dx*i]===c){b++;i++;}
    const n=a+b+1;
    if(n>=5) score+=1000;
    else if(n===4) score+=400;
    else if(n===3) score+=120;
    else if(n===2) score+=40;
  });
  return score;
}

function tap(x,y){
  if(gameOver||board[y][x]) return;

  if(pending && pending.x===x && pending.y===y){
    confirmMove(x,y);
    pending=null;
    return;
  }

  clearPreview();
  showPreview(x,y);
  pending={x,y};
}

function showPreview(x,y){
  const s=document.createElement("div");
  s.id="preview";
  s.className="stone black preview";
  s.style.left=(x*step)+"%";
  s.style.top=(y*step)+"%";
  points.appendChild(s);
}

function clearPreview(){
  const p=document.getElementById("preview");
  if(p) p.remove();
}

function place(x,y,c){
  board[y][x]=c;
  const s=document.createElement("div");
  s.className="stone "+c;
  s.style.left=(x*step)+"%";
  s.style.top=(y*step)+"%";
  points.appendChild(s);

  const ink=document.createElement("div");
  ink.className="ink";
  ink.style.left=(x*step)+"%";
  ink.style.top=(y*step)+"%";
  points.appendChild(ink);
  setTimeout(()=>ink.remove(),600);
}

function confirmMove(x,y){
  clearPreview();
  place(x,y,"black");
  const sc=evalMove(x,y,"black");
  log(`ã‚ãªãŸï¼š(${x+1},${y+1}) è©•ä¾¡ã€${rank(sc)}ã€‘`,"player");
  if(checkWin(x,y,"black")) return win("ã‚ãªãŸã®å‹ã¡");
  setTimeout(cpuTurn,400);
}

function cpuTurn(){
  let best={s:-1};
  for(let y=0;y<SIZE;y++)for(let x=0;x<SIZE;x++){
    if(!board[y][x]){
      const s=evalMove(x,y,"white");
      if(s>best.s) best={x,y,s};
    }
  }
  place(best.x,best.y,"white");
  log(`CPUï¼š(${best.x+1},${best.y+1}) è©•ä¾¡ã€${rank(best.s)}ã€‘`,"cpu");
  if(checkWin(best.x,best.y,"white")) return win("CPUã®å‹ã¡");
}

function checkWin(x,y,c){
  return [[1,0],[0,1],[1,1],[1,-1]].some(([dx,dy])=>{
    let n=1,i=1;
    while(board[y+dy*i]?.[x+dx*i]===c){n++;i++;}
    i=1;
    while(board[y-dy*i]?.[x-dx*i]===c){n++;i++;}
    return n>=5;
  });
}

function win(msg){
  gameOver=true;
  statusEl.textContent=msg;
  log(msg,"result");
  if(msg.includes("ã‚ãªãŸ")){
    for(let i=0;i<30;i++){
      const p=document.createElement("div");
      p.className="petal";
      p.textContent="ğŸŒ¸";
      p.style.left=Math.random()*100+"vw";
      p.style.animationDuration=(4+Math.random()*2)+"s";
      document.body.appendChild(p);
      setTimeout(()=>p.remove(),6000);
    }
  }
}

function resetGame(){
  board=[...Array(SIZE)].map(()=>Array(SIZE).fill(null));
  points.innerHTML="";
  logEl.innerHTML="";
  gameOver=false;
  pending=null;
  location.reload();
}
</script>
</body>
</html>
