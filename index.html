<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äº”ç›®ä¸¦ã¹ï½œæ€è€ƒè¦³æ¸¬ç›¤</title>

<!-- å¢¨ãƒ•ã‚©ãƒ³ãƒˆ -->
<link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho&family=Zen+Kurenaido&display=swap" rel="stylesheet">

<style>
:root{
  --ink:#1a1a1a;
  --paper:#f7f2e8;
  --wood1:#7c4a1d;
  --wood2:#4a2a10;
}

/* ===== å…¨ä½“ ===== */
body{
  margin:0;
  background:
    url("https://www.transparenttextures.com/patterns/paper-fibers.png"),
    radial-gradient(circle at top, #2a1b0f, #0b0703);
  color:var(--ink);
  font-family:"Shippori Mincho",serif;
}

.app{
  max-width:520px;
  margin:auto;
  padding:10px;
}

/* ===== ã‚¿ã‚¤ãƒˆãƒ« ===== */
.header{
  text-align:center;
  margin-bottom:6px;
}
.header h1{
  margin:4px 0;
  letter-spacing:8px;
  font-weight:normal;
}
.subtitle{
  font-size:12px;
  opacity:.6;
}

/* ===== æ“ä½œ ===== */
.controls{
  display:flex;
  justify-content:center;
  gap:8px;
  margin:6px 0;
}
select,button{
  font-family:"Shippori Mincho",serif;
  background:var(--paper);
  border:1px solid #aaa;
  padding:6px 14px;
  border-radius:999px;
}

/* ===== çŠ¶æ…‹ ===== */
#status{
  text-align:center;
  margin:6px 0;
}

/* ===== ç›¤ ===== */
.board-wrap{
  background:linear-gradient(145deg,var(--wood1),var(--wood2));
  padding:8px;
  border-radius:14px;
  box-shadow:inset 0 0 0 2px rgba(0,0,0,.4),
             0 15px 40px rgba(0,0,0,.6);
}
.board{
  display:grid;
  grid-template-columns:repeat(15,1fr);
  aspect-ratio:1/1;
  background:
    repeating-linear-gradient(to right, rgba(0,0,0,.4) 0 1px, transparent 1px calc(100%/15)),
    repeating-linear-gradient(to bottom, rgba(0,0,0,.4) 0 1px, transparent 1px calc(100%/15));
}
.cell{position:relative;}
.cell::after{
  content:"";
  position:absolute;
  inset:12%;
  border-radius:50%;
  transform:scale(0);
  transition:.15s ease;
}
.cell.black::after{
  background:radial-gradient(circle at 30% 30%,#555,#000);
  transform:scale(1);
}
.cell.white::after{
  background:radial-gradient(circle at 30% 30%,#fff,#ccc);
  transform:scale(1);
}

/* å¢¨ã«ã˜ã¿ */
.cell::before{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(circle, rgba(0,0,0,.25), transparent 60%);
  opacity:0;
}
.cell.black::before,
.cell.white::before{
  animation:ink .4s ease;
}
@keyframes ink{
  from{opacity:.8;}
  to{opacity:0;}
}

/* ===== ãƒ­ã‚° ===== */
.log{
  margin-top:10px;
  background:var(--paper);
  border:2px solid #333;
  border-radius:10px;
  padding:6px;
  max-height:180px;
  overflow-y:auto;
  font-family:"Zen Kurenaido",sans-serif;
  font-size:12px;
}
.log .player{color:#1e40af;}
.log .cpu{color:#7f1d1d;}
.log .result{color:#000;font-weight:bold;}
.log div{padding:2px 0;border-bottom:1px dashed #aaa;}

/* ===== èŠ±å¼ ===== */
.petal{
  position:fixed;
  top:-20px;
  font-size:20px;
  animation:fall linear forwards;
  pointer-events:none;
}
@keyframes fall{
  to{transform:translateY(120vh) rotate(360deg);opacity:0;}
}
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <h1>äº”ç›®ä¸¦ã¹</h1>
    <div class="subtitle">æ€è€ƒè¦³æ¸¬ç›¤</div>
  </div>

  <div class="controls">
    <select id="level">
      <option value="ume">æ¢…</option>
      <option value="take" selected>ç«¹</option>
      <option value="matsu">æ¾</option>
    </select>
    <button onclick="resetGame()">å†æˆ¦</button>
  </div>

  <div id="status">ã‚ãªãŸï¼ˆé»’ï¼‰ã®ç•ª</div>

  <div class="board-wrap">
    <div id="board" class="board"></div>
  </div>

  <div id="log" class="log"></div>
</div>

<script>
const SIZE=15;
const boardEl=document.getElementById("board");
const logEl=document.getElementById("log");
const statusEl=document.getElementById("status");

let board=[],gameOver=false;

function log(t,c){
  const d=document.createElement("div");
  d.textContent=t;
  d.className=c;
  logEl.appendChild(d);
  logEl.scrollTop=logEl.scrollHeight;
}

function rank(score){
  if(score>=30) return "è‰¯";
  if(score>=12) return "æ™®";
  return "å¾®";
}

function evaluate(x,y,c){
  let s=0;
  [[1,0],[0,1],[1,1],[1,-1]].forEach(([dx,dy])=>{
    let n=0,nx=x+dx,ny=y+dy;
    while(board[ny]?.[nx]===c){n++;nx+=dx;ny+=dy;}
    s+=n*n*5;
  });
  return s;
}

function init(){
  board=Array.from({length:SIZE},()=>Array(SIZE).fill(null));
  boardEl.innerHTML="";
  logEl.innerHTML="";
  gameOver=false;
  statusEl.textContent="ã‚ãªãŸï¼ˆé»’ï¼‰ã®ç•ª";
  for(let y=0;y<SIZE;y++)for(let x=0;x<SIZE;x++){
    const c=document.createElement("div");
    c.className="cell";
    c.onclick=()=>move(x,y,c);
    boardEl.appendChild(c);
  }
  log("å¯¾å±€é–‹å§‹","result");
}

function move(x,y,cell){
  if(gameOver||board[y][x])return;
  const s=evaluate(x,y,"black");
  board[y][x]="black";
  cell.classList.add("black");
  log(`ã‚ãªãŸï¼š(${x+1},${y+1}) ${rank(s)}ï¼ˆ${s}ï¼‰`,"player");
  if(win(x,y,"black")){
    end("ã‚ãªãŸã®å‹ã¡");
    return;
  }
  statusEl.textContent="CPU æ€è€ƒä¸­â€¦";
  setTimeout(cpu,300);
}

function cpu(){
  let best={s:-1};
  for(let y=0;y<SIZE;y++)for(let x=0;x<SIZE;x++)if(!board[y][x]){
    const s=evaluate(x,y,"white")+evaluate(x,y,"black")*0.9;
    if(s>best.s) best={x,y,s};
  }
  const i=best.y*SIZE+best.x;
  board[best.y][best.x]="white";
  boardEl.children[i].classList.add("white");
  log(`CPUï¼š(${best.x+1},${best.y+1}) ${rank(best.s)}ï¼ˆ${best.s}ï¼‰`,"cpu");
  if(win(best.x,best.y,"white")){
    end("CPUã®å‹ã¡");
    return;
  }
  statusEl.textContent="ã‚ãªãŸï¼ˆé»’ï¼‰ã®ç•ª";
}

function win(x,y,c){
  return[[1,0],[0,1],[1,1],[1,-1]].some(([dx,dy])=>{
    let n=1;
    for(let i=1;i<5;i++) if(board[y+dy*i]?.[x+dx*i]===c) n++; else break;
    for(let i=1;i<5;i++) if(board[y-dy*i]?.[x-dx*i]===c) n++; else break;
    return n>=5;
  });
}

function end(t){
  statusEl.textContent=t;
  log(t,"result");
  gameOver=true;
  petals();
}

function petals(){
  for(let i=0;i<30;i++){
    const p=document.createElement("div");
    p.textContent="ğŸŒ¸";
    p.className="petal";
    p.style.left=Math.random()*100+"vw";
    p.style.animationDuration=3+Math.random()*3+"s";
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),6000);
  }
}

function resetGame(){init();}
init();
</script>
</body>
</html>
